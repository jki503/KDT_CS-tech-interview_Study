# 프로세스와 스레드

</br>

## Process

</br>

> 프로세스는 메모리의 독립적인 영역을 할당 받아 실행되는 프로그램으로 OS에서의 작업 단위

</br>

|                 프로세스 - 메모리                 |
| :-----------------------------------------------: |
| ![프로세스-메모리 img](./res/process_concept.png) |

| segment |                     description                      |
| :-----: | :--------------------------------------------------: |
| `code`  |                 실행되는 명령어 코드                 |
| `data`  |               전역변수, 정적 변수 할당               |
| `heap`  |        run time에서 동적으로 할당 받는 메모리        |
| `stack` | 함수 호출 시 관계되는 지역변수와 매개 변수 할당 영역 |

</br>

- initalized 영역은 해당 RAM뿐만 아니라 데이터의 초기 값을 가지고 있을 ROM에 할당 되어야하지만
- uninitalized 영역은 RAM에 해당 영역만큼 공간을 할당 한다.
- heap은 runtime에 크기 결정
- stack은 이미 생성되어 있는 스택에 대해 포인터 위치만 바꿔주는 CPU Instruction
- heap은 요청된 chunk의 크기 현재 메모리 fragmentation 상황 등 다양한 요소를 고려
- 따라서 stack 더 빠르다.

</br>

|                 프로세스 라이프 사이클                 |
| :----------------------------------------------------: |
| ![프로세스 라이프 사이클 img](./res/process_cycle.png) |

</br>

- 프로세스는 생성 된 후 ready queue에 들어감
- scheduler dispatch로 running 상태
- 실행중인 프로세스는 IO나 event 발생 시 waiting queue로 이동
- interrupt 발생시 ready queue로 이동
- running 상태에서 exit이나 프로세스를 반환하면 종료

</br>

### Context Switching

</br>

> 현재 실행 중인 프로세스에서 인터럽트가 발생 할 경우  
> 시스템이 현재 프로세스의 컨텍스트를 저장하고  
> 새로 실행될 프로세스의 컨텍스트를 재개 하는 것
> 프로세스는 독립된 메모리 영역을 할당 받아 사용하기 때문에  
> 캐시 메모리 초기화와 같은 무거운 작업을 진행하여 비용이 높은 작업이다.

</br>

### PCB

|          Data          |                    description                     |
| :--------------------: | :------------------------------------------------: |
|          PID           |                  프로세스 식별자                   |
|     Process state      |            프로세스 cycle에서 현재 상태            |
|           PC           |     현재 프로세스가 실행할 다음 명령어의 주소      |
|    CPU resigisters     |                       DR, IR                       |
| Accounting information |     페이지 테이블, 스케줄링 큐 포인터 부모 등      |
|       I/O status       | 프로세스에 할당된 입출력 장치 목록, 열린 파일 목록 |

</br>

## Thread

</br>

> 쓰레드란 프로세스 내에서 독립적으로 실행되는 하나의 작업 단위

</br>

|             Thread              |
| :-----------------------------: |
| ![thread img](./res/thread.png) |

</br>

> 쓰레드는 프로세스와 다르게 code, data, heap 영역을 공유하고, stack은 공유하지 앟는다.  
> 왜냐하면 thread 내의 함수에 대한 개별 저장 공간이 요구 되기 때문  
> 또한 같은 주소 안에서 thread간의 switching은  
> 해당 쓰레드의 정보 PC, registers만 저장하면 됨으로 훨씬 가볍다.

</br>

## 프로세스와 쓰레드 차이

> 프로세스는 독립적인 주소 공간을 할당 받고 해당
> 프로세스에서 문제가 발생한다면 다른 프로세스에
> 영향을 주지 않는다.  
> 그러나 공유 자원을 사용하고 싶다면 IPC와 기법을 사용해야하는데 별도의 설비 및 구현이 쉽지 않고,
> Context switching의 오버헤드 문제도 고려
> 쓰레드는 반면 하나의 프로세스가 가지고 있는 공유자원을 사용 할 수 있고, Context 스위칭에 비하면 thread의 스케줄링은 보다 더 비용이 적은 편이다.
> 다만 하나의 쓰레드에서 문제 발생시 프로세스에 악영향을 줄 수 있고, 이에 따라 다른 쓰레드들도 영향을 받는다.  
> critical section에 대한 동기화 문제를 고려해야한다.
